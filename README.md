# Решение команды MISIS Leaf Lovers для хакатона "Привет, Спутник!" от компании СОНИКС и Геоскан

## Описание проекта
Это веб-приложение, разработанное для хакатона *"Привет, Спутник!"* от компании *СОНИКС*. Решаемый кейс — автоматизация отслеживания работы наземной станции в режиме реального времени. Приложение предоставляет удобный интерфейс для работы с картами, архивами данных, уведомлениями и другими функциями.

## Команда
Команда MISIS Leaf Lovers состоит из студентов 2 курса института компьютерных наук НИТУ МИСИС.
- **Второв Фёдор Иванович** - Капитан команды, Бэкенд разработчик
- **Емельянцев Михаил Дмитриевич**  - Бэкенд разработчик
- **Великанов Вадим Михайлович** - Фронтенд разработчик
- **Беляев Владимир Антонович** - Фронтенд разработчик, Дизайнер


## Основные термины
Чтобы понять, как работает проект, надо понять основные термины, которые используются в этом README.

**SDR**
Программно определяемая радиосистема - это радиосистема, в которой традиционно аппаратные компоненты (например, модулятор, демодулятор, фильтры, микшеры и т.д.) реализуются программно, а не с помощью специализированной электроники.

**WebSDR**
Система программно-определяемой радиосвязи (SDR), доступная через веб-интерфейс, позволяющая принимать и обрабатывать сигналы в реальном времени.

**GNURadio**
Инструментарий с открытым исходным кодом для создания программно-определяемых радиосистем, используемых для обработки и анализа радиосигналов. GNURadio Pipeline - программа из блоков GNURadio (или может быть представлена кодом, то есть каждый блок - код).

**Osmocom Source**
Блок GNURadio который берет данные с SDR и передает их дальше в pipeline.

**Сеть СОНИКС**
Сеть спутниковой связи для управления наземными станциями и отслеживания спутников.

**Наземная станция**
Наземное сооружение, оборудованное для связи со спутниками, включая прием и передачу сигналов.

**WebSocket**
Протокол связи, обеспечивающий двунаправленный обмен данными в реальном времени между клиентом и сервером.

**Обработка сигналов**
Анализ, интерпретация и обработка сигналов, полученных со спутников.

**Планировщик наблюдений**
Инструмент для планирования и управления сеансами спутниковых наблюдений.

## Техническое описание
Проект состоит из 2 главных частей: серверная часть и клиентская часть. Серверная часть должна включаться напрямую на портал [sonik.space](sonik.space), а клиентская часть включается в [клиент соникса](https://gitlab.com/space-education-development/soniks/soniks-client). Рассмотрим как работает каждая из них:

### Серверная часть

Серверная часть приложения создана с использованием **Flask**, облегченного веб-фреймворка Python, и интегрируется с базой данных **PostgreSQL** через **SQLAlchemy** для управления данными. Ниже приведен обзор того, как работают компоненты на стороне сервера:

---

#### 1. **Инициализация и настройка базы данных**
- Файл bdinit.py содержит функции для инициализации схемы базы данных и заполнения ее базовыми данными:
- `init_bd()`: создает все таблицы базы данных, определенные в файле dbmanager.py.
- `populate_base_data()`: добавляет образцы пользователей, станций и записей о владельце в базу данных для целей тестирования.

---

#### 2. **Управление базой данных**
- Файл dbmanager.py определяет схему базы данных и предоставляет служебные функции для взаимодействия с базой данных:
- **Модели**:
- `User`: представляет пользователей системы, хранит учетные данные, ключи API и контактную информацию.
- `Station`: представляет наземные станции спутниковой связи, включая местоположение, настройки уведомлений и адреса серверов SDR.
- `Ownership`: связывает пользователей со станциями, которыми они владеют.
- **Служебные функции**:
- `update_station_info()`: обновляет данные о станции, такие как имя, местоположение и настройки уведомлений.
- `get_station_owner()`: извлекает владельца определенной станции.
- `get_stations_by_user_id()`: извлекает все станции, принадлежащие пользователю.
- `confirm_ownership()`: подтверждает, является ли пользователь владельцем определенной станции.
- `register_sdr_bd()`: регистрирует адрес сервера SDR для станции.

---

#### 3. **Веб-приложение**
- Файл main.py определяет приложение Flask и его маршруты. Маршруты специально подобраны для удобства интеграции с платформой соникс:
- **Аутентификация**:
- `/login`: обрабатывает вход пользователя с использованием учетных данных, хранящихся в базе данных.
- `/logout`: выходит из системы текущего пользователя.
- **Управление пользователями и станциями**:
- `/users/<name>`: отображает все станции, принадлежащие пользователю.
- `/stations/<id>`: отображает подробную информацию о конкретной станции.
- `/stations/<id>/edit`: позволяет пользователям редактировать сведения о станции.
- **Панель управления станцией**:
- `/stations/<id>/dashboard`: отображает панель управления для конкретной станции, включая карты и спутниковое отслеживание. Внутри этой страницы iframe, внутри которого грузятся страница клиентской части /start_conn, а также следующие пути:
- `/stations/<id>/dashboard/map`: Создает карту с треками спутников и зонами покрытия.
- `/stations/<id>/dashboard/reception`: Перенаправляет на сервер SDR для приема сигнала.
- `/stations/<id>/dashboard/archive`: Отображает архивные данные для станции.
- `/stations/<id>/dashboard/settings`: Позволяет пользователям настраивать параметры уведомлений и ключи API.
- **Регистрация SDR**:
- `/stations/<id>/register_sdr`: Регистрирует сервер SDR для станции с помощью ключа API.

---

#### 4. **Спутниковое отслеживание и визуализация**
- Файл map.py предоставляет функциональные возможности для спутникового отслеживания и визуализации:
- `get_satellite_tracks_from_tle(tle_str)`: обрабатывает строку TLE (двухстрочный элемент) для расчета спутниковых треков и текущих положений.
- Маршрут `/stations/<id>/dashboard/map` использует эту функцию для создания:
- **визуализации карты**, показывающей спутниковые треки и зоны покрытия станции.
- **полярного графика**, показывающего видимость спутника со станции.


### 5. **SMTP Сервер**
- Файл mail.py нужен для отправки уведомлений о статусе наземной станции.
- В текущем состоянии сервер работает, но он не подключен к
---

Эта серверная архитектура обеспечивает эффективное управление учетными записями пользователей, наземными станциями и данными спутникового слежения, предоставляя при этом удобный интерфейс для мониторинга и управления наземными станциями.

### Клиентская часть

Клиентская сторона приложения отвечает за управление оборудованием SDR (Software-Defined Radio), обработку данных IQ и передачу их на сервер для визуализации и анализа. Ниже приведен обзор компонентов на стороне клиента:

---

#### 1. **Управление конвейерами**
- **Файл:** pipelines.py
Этот файл определяет доступные конвейеры обработки сигнала:
```python
pipelines = {0: 'None', 1: 'RDS'}
```
- `None`: Никакая дополнительная обработка не применяется к сигналу.
- `RDS`: Конвейер для обработки сигналов Radio Data System (RDS).
Эта функция не имплементирована
---

#### 2. **Регистрация SDR**
- **Файл:** register_sdr.py
Этот скрипт позволяет пользователям регистрировать свой сервер SDR в сети Soniks:
- Запрашивает у пользователя:
- URL-адрес сервера Soniks.
- Идентификатор станции.
- Ключ API.
- IP-адрес и порт станции.
- Отправляет запрос на регистрацию на сервер, используя предоставленные данные:
```python
d = requests.get(f"http://{server_url}/stations/{station_id}/register_sdr?address={station_address}&key={API_KEY}")
```
- Выводит ответ сервера, включая код состояния и сообщение.

---

#### 3. **Обработка данных SDR и интеграция WebSocket**
- **Файл:** server.py
Этот файл реализует основные функции клиентской системы SDR:
- **Приложение Flask**:
- Размещает локальный веб-сервер для управления операциями SDR и предоставления пользовательского интерфейса.
- **Интеграция SDR**:
- Использует `osmosdr` для взаимодействия с оборудованием SDR.
- Настраивает SDR с такими параметрами, как центральная частота, частота дискретизации и полоса пропускания.
- **Обработка сигналов**:
- Обрабатывает данные IQ с помощью БПФ (быстрое преобразование Фурье) для генерации данных в частотной области.
- Преобразует обработанные данные в формат, подходящий для передачи.
- **Связь через WebSocket**:
- Передает обработанные данные SDR на сервер через WebSocket для визуализации в реальном времени.
- **Эндпоинты**:
- `/start_conn`: запускает SDR и начинает передачу данных.
- `/stop_sdr`: останавливает SDR и завершает поток данных.
- `/change_freq`: динамически обновляет центральную частоту SDR.
- `/render_reception`: визуализирует интерфейс приема с доступными конвейерами.

---

#### 4. **Основные функции**
- **Передача данных в реальном времени**:
- Обрабатывает данные SDR IQ и отправляет их на сервер в реальном времени с помощью WebSocket.
- **Динамическое управление частотой**:
- Позволяет пользователям изменять центральную частоту SDR без перезапуска системы.
- **Веб-интерфейс**:
- Предоставляет удобный интерфейс для управления операциями SDR.

---

Эта клиентская архитектура обеспечивает бесшовную интеграцию с сервером, позволяя обрабатывать сигналы в реальном времени и визуализировать сеть Soniks.


## Потенциал развития проекта
То, что мы хотели бы добавить, чтобы дополнить проект:
- 3D Карта для лучшей визуализации
- Использовать технологию расширения LAN по типу *ZeroTier* или *Hamachi* для удобства настройки P2P коммуникации между серверами
- Контейнеризровать решение с помощью *Docker* чтобы развернуть наше решение на всех платформах и операционных системах

## Стек технологий
Проект разработан с использованием следующих технологий:

### Backend:
- **Python** (Flask) — для обработки запросов и управления серверной логикой.
- **Matplotlib**: создает визуализации для спутниковых треков и зон покрытия.
- **Beyond.io**: обрабатывает данные TLE для спутникового отслеживания.
- **PostgreSQL**: хранит данные о пользователях, станциях и владельцах.
- **SQLAlchemy** — для хранения данных (выберите вашу базу данных).

### Frontend:
- **HTML** и **CSS** — для создания пользовательского интерфейса.
- **JavaScript** — для динамического взаимодействия с пользователем.
- **Bootstrap5** — для адаптивного дизайна.

### Прочее:
- **Jinja2** — для шаблонизации HTML.

---

## Установка и запуск проекта (Серверная часть)

Перед запуском проекта на северной части следует установить PostgreSQL, и создать пустую базу данных soniks.

### 1. Клонирование репозитория
Склонируйте проект на ваш локальный компьютер:
```bash
git clone https://github.com/BUSH222/soniks-hack
cd soniks-hack
```

### 2. Установка зависимостей
Убедитесь, что у вас установлен Python (рекомендуется версия 3.8 или выше). Установите виртуальное окружение и зависимости:
```bash
#Windows
pip install -r requirements.txt
```

### 3. Можно запускать проект!

## Основные функции
- Карта: Визуализация станций на карте.
- Прием сигналов: Управление сигналами и их обработка.
- Архив и аналитика: Просмотр и анализ исторических данных.
- Планировщик: Планирование наблюдений.
- Настройки: Управление уведомлениями, API-ключами и другими параметрами.

Для запуска клиентской части требуется SDR и установка GNURadio и gr-osmocom. Затем, следуете инструкциям установки серверной части, но склонируйте ветку dev-client. Мы тестировали проект используя RTL-SDR Blog v3. 

---
## Демонстрация работы проекта

### Страница login:
![login](/readme_images/login.png)


### Страница c показом станций пользователя:
![stations](/readme_images/stations.png)

### Страница одной станции:
![station 1](/readme_images/station_1.png)

### Dashboard:
Внутри дашборда есть несколько секций, каждая делает что-то свое.
#### Секция карты:
![dashboard](/readme_images/dashboard_map.png)
Показывает траектории спутников, полярный график, и информацию об орбите спутника который следующим будет пролетать над станцией. Формула покрытия станции (желтый круг) была выведена нами.

#### Секция архива и аналитики:
Работает с API соникса, но так как наша станция не зарегестриирована там, то все по нулям.

![stats](/readme_images/dashboard_stats.png)

#### Секция настроек:

![stats](/readme_images/dashboard_notifications.png)

#### Секция приема сигналов:
Это лучше продемонстрировать на видео.

https://disk.yandex.ru/i/xi_UOFOAw_9vzg

На видео представлено как пользователь будет входить в систему, и подключаться к SDR удаленно. В данном случае на водопаде (waterfall graph) представлен Wideband FM радиосигнал от останкинской башни.

## Заключение
Наше решение представляет собой комплексное решение для управления наземными станциями спутниковой связи в реальном времени. Он сочетает в себе мощный серверный функционал, удобный пользовательский интерфейс и возможности обработки сигналов SDR. Благодаря использованию современных технологий, таких как Flask, PostgreSQL, WebSocket и GNURadio, проект обеспечивает надежную работу и гибкость в настройке.

Мы надеемся, что это решение станет полезным инструментом для операторов наземных станций и исследователей, работающих в области спутниковой связи. В будущем мы планируем расширить функционал, добавив 3D-визуализацию, поддержку P2P-коммуникации и контейнеризацию с помощью Docker, чтобы сделать проект еще более универсальным и удобным для использования.

Если у вас есть вопросы или предложения, пожалуйста, свяжитесь с нами через [GitHub Issues](https://github.com/BUSH222/soniks-hack/issues). Мы будем рады вашему вкладу в развитие проекта!

## Лицензия
Проект распространяется под лицензией MIT (см [LICENSE](/LICENSE)). Это означает, что вы можете свободно использовать, копировать, изменять и распространять программное обеспечение, при условии, что во всех копиях или значительных частях программного обеспечения сохраняется оригинальное уведомление об авторских правах и разрешении.
